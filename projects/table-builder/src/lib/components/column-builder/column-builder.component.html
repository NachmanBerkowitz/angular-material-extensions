<ng-container [matColumnDef]="metaData.key" >

  <ng-template #body let-element='element' >
    <mat-cell [styler]='styles'  (click)='cellClicked(element, metaData.key)' *ngrxLet="bodyStyles$ as styles">
        <ng-container *ngTemplateOutlet="innerTemplate;context: {metaData: metaData, element: element, transform: transform }">
        </ng-container>
    <span class="no-val" *ngIf="metaData.fieldType !== FieldType.Expression && ( element[metaData.key]===null || element[metaData.key]===undefined) &&
     !((customCell && customCell.TemplateRef) || metaData.template)">-</span>
    </mat-cell>
  </ng-template>

  <ng-template matHeaderCellDef #myHeader>

    <ng-container *ngIf="customCell?.columnDef?.headerCell;else header;">
      <ng-container *ngrxLet="headerStyles$ as styles">
        <ng-container *ngTemplateOutlet="customCell.columnDef.headerCell.template; context: {metaData: metaData, styles:  styles} ">
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-template #header>

      <mat-header-cell  [styler]='styles' [resizeColumn]="true" [key]="metaData.key"   class="column-head" #headref *ngrxLet="headerStyles$ as styles">
        <div class="header-container">
          <div *ngIf="!metaData._internalNotUserDefined || !customCell?.columnDef?.cell ; else headerWithoutMenu" mat-sort-header style="width: 100%">
            {{ metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ) }}
          </div>
          <ng-template #headerWithoutMenu >
            <div *ngIf="metaData._internalNotUserDefined;" style="width: 100%">
              {{ metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ) }}
            </div>
          </ng-template>

          <tb-header-menu *ngIf="(!metaData._internalNotUserDefined || !customCell?.columnDef?.cell) && (!metaData.noFilter)" #menu [metaData]='metaData' [filter]='filter' ></tb-header-menu>
        </div>
      </mat-header-cell>
    </ng-template>
  </ng-template>


  <ng-container *matCellDef="let element;">
     <ng-container *ngrxLet="bodyStyles$ as styles">
       <ng-container *ngTemplateOutlet="outerTemplate; context: {metaData: metaData, element: element , styles: styles }">
        </ng-container>
     </ng-container>
  </ng-container>

  <ng-template matFooterCellDef>
    <ng-container *ngrxLet="footerStyles$ as styles">
      <ng-container *ngIf="customCell?.columnDef?.footerCell;else footer">
        <ng-container
          *ngTemplateOutlet="customCell.columnDef.footerCell.template;context: {metaData: metaData, data: data$, styles : styles }">
        </ng-container>
      </ng-container>
    </ng-container>

    <ng-template #footer>
      <mat-footer-cell  [styler]='styles' *ngrxLet="footerStyles$ as styles">
        <span *ngIf="metaData.additional?.footer" [ngSwitch]="metaData.fieldType">
          <span *ngSwitchCase="FieldType.Currency">
            {{ data$ | columnTotal: metaData | async | currency }}
          </span>
        </span>
      </mat-footer-cell>
    </ng-template>
  </ng-template>
</ng-container>
